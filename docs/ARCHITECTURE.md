# Архитектура

## Компоненты

- **`autoparse.py`**: точка входа в приложение. Этот скрипт инициализирует бота и диспетчер `aiogram`, регистрирует обработчики и запускает поллинг.

- **`bot_handler.py`**: содержит логику обработки сообщений Telegram. Принимает ссылки от пользователя, вызывает скрапер и отправляет результат обратно в чат.

- **`scraper.py`**: модуль-оркестратор. Получает URL, вызывает `tmapi.py` для сбора данных, `exchange_rate.py` для получения курса валют (если включено), а затем передает всю информацию в `yandex_gpt.py` для генерации финального текста поста.

- **`tmapi.py`**: клиент для `tmapi.top` API. Отвечает за единственный запрос к сервису для получения всей информации о товаре.

- **`exchange_rate.py`**: клиент для `v6.exchangerate-api.com`. Получает курс CNY к RUB и кэширует его до следующего обновления, указанного API.

- **`yandex_gpt.py`**: клиент для YandexGPT API. Формирует сложный промпт и отправляет данные о товаре нейросети для создания креативного и краткого поста.

- **`config.py`**: модуль для управления конфигурацией. Использует `pydantic-settings` для загрузки всех ключей API, токенов и других настроек (включая флаг `CONVERT_CURRENCY`) из `.env` файла.

- **`.env`**: файл для хранения всех секретов. Не должен попадать в систему контроля версий.

- **`requirements.txt`**: список всех зависимостей Python.

- **`dockerfile`**: Инструкции для сборки Docker-образа приложения.

## Поток данных

1.  Пользователь отправляет URL-адрес товара в Telegram-бот.
2.  `bot_handler.py` получает сообщение и вызывает `scraper.py`.
3.  `scraper.py` вызывает `tmapi.py` для получения данных о товаре.
4.  Если флаг `CONVERT_CURRENCY` в `.env` установлен в `True`, `scraper.py` вызывает `exchange_rate.py` для получения курса валют.
5.  `scraper.py` вызывает `yandex_gpt.py`, передавая ему всю собранную информацию.
6.  `yandex_gpt.py` обращается к YandexGPT, которая генерирует готовый текст поста.
7.  `scraper.py` возвращает готовый текст и список изображений в `bot_handler.py`.
8.  `bot_handler.py` отправляет медиагруппу с изображениями и сгенерированным текстом в тот же чат, откуда пришло сообщение.