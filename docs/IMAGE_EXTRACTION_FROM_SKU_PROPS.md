# üì∏ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ sku_props

## –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏

### ‚ùå –ë–´–õ–û (–∏–∑ main_imgs):
```python
image_urls = product_data.get('main_imgs', [])
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û–±—â–∏–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞
- –ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º (—Ü–≤–µ—Ç–∞–º, –º–æ–¥–µ–ª—è–º)
- –ú–æ–∂–µ—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

---

### ‚úÖ –°–¢–ê–õ–û (–∏–∑ sku_props):
```python
image_urls = self._get_unique_images_from_sku_props(product_data)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –§–æ—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Ü–≤–µ—Ç–∞–º/–º–æ–¥–µ–ª—è–º
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
- ‚úÖ –¢–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- ‚úÖ Fallback –Ω–∞ `main_imgs` –µ—Å–ª–∏ `sku_props` –ø—É—Å—Ç–æ

---

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö sku_props

```json
{
  "sku_props": [
    {
      "pid": "22041",
      "prop_name": "È¢úËâ≤ÂàÜÁ±ª",
      "values": [
        {
          "vid": "29040797540",
          "name": "„ÄêÈÖíÁ∫¢Ëâ≤„ÄëËÇ§ÊÑüÁ£®Á†ÇÁ°¨Â£≥‚òÖËá™Â∏¶ÈïúÂ§¥ËÜú",
          "imageUrl": "https://img.alicdn.com/...jpg"
        },
        {
          "vid": "29096565807",
          "name": "„ÄêÊöóÂ§úÁ¥´„ÄëËÇ§ÊÑüÁ£®Á†ÇÁ°¨Â£≥‚òÖËá™Â∏¶ÈïúÂ§¥ËÜú",
          "imageUrl": "https://img.alicdn.com/...jpg"
        }
      ]
    },
    {
      "pid": "23448",
      "prop_name": "ÈÄÇÁî®ÊâãÊú∫ÂûãÂè∑",
      "values": [
        {
          "vid": "46556282",
          "name": "iPhone 17",
          "imageUrl": ""
        }
      ]
    }
  ]
}
```

### 2. –ê–ª–≥–æ—Ä–∏—Ç–º –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

```python
def _get_unique_images_from_sku_props(self, product_data: dict) -> list:
    unique_images = []
    seen_urls = set()  # –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
    
    sku_props = product_data.get('sku_props', [])
    
    # 1. –ï—Å–ª–∏ sku_props –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí fallback
    if not sku_props:
        return product_data.get('main_imgs', [])
    
    # 2. –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å–≤–æ–π—Å—Ç–≤–∞–º
    for prop in sku_props:
        values = prop.get('values', [])
        
        # 3. –ò–∑–≤–ª–µ–∫–∞–µ–º imageUrl –∏–∑ –∫–∞–∂–¥–æ–≥–æ value
        for value in values:
            image_url = value.get('imageUrl', '').strip()
            
            # 4. –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏ –Ω–µ–ø—É—Å—Ç—ã–µ
            if image_url and image_url not in seen_urls:
                seen_urls.add(image_url)
                unique_images.append(image_url)
    
    # 5. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏ ‚Üí fallback
    if not unique_images:
        return product_data.get('main_imgs', [])
    
    return unique_images
```

---

## –ü—Ä–∏–º–µ—Ä (–∏–∑ result55.txt)

### –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

**main_imgs:** 5 –æ–±—â–∏—Ö —Ñ–æ—Ç–æ
```json
"main_imgs": [
  "https://img.alicdn.com/.../O1CN01R5FCFp21SGi59yENn_!!0-item_pic.jpg",
  "https://img.alicdn.com/.../O1CN01TCpNHf21SGd6Bi1Of_!!2212606996983.jpg",
  "https://img.alicdn.com/.../O1CN01Dsl42d21SGd8CReS5_!!2212606996983.jpg",
  "https://img.alicdn.com/.../O1CN010sLevv21SGd68SDYt_!!2212606996983.jpg",
  "https://img.alicdn.com/.../O1CN01EbBbgx21SGcxx90Xh_!!2212606996983.jpg"
]
```

**sku_props (È¢úËâ≤ÂàÜÁ±ª):** 13 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ü–≤–µ—Ç–æ–≤ —Å —Ñ–æ—Ç–æ
```json
"values": [
  {"name": "„ÄêÈÖíÁ∫¢Ëâ≤„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÊöóÂ§úÁ¥´„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÈíõÁÅ∞Ëâ≤„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÂ∞ëÂ•≥Á≤â„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêË±ÜËîªÁªø„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÁü≥Â¢®ÁÅ∞„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÊ∑±Êµ∑Ëìù„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêËøúÂ≥∞Ëìù„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÁàµÂ£´Èªë„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÂíñÂï°Ëâ≤„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêËãçÂ≤≠Áªø„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÁà±ÁéõÊ©ô„Äë...", "imageUrl": "https://...jpg"},
  {"name": "„ÄêÁ∫ØÁôΩËâ≤„Äë...", "imageUrl": "https://...jpg"}
]
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ **–ò–∑–≤–ª–µ—á–µ–Ω–æ:** 13 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π —Ü–≤–µ—Ç)  
‚úÖ **–ü–æ–∫–∞–∑–∞–Ω—ã:** –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞  
‚úÖ **–ë–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:** –ö–∞–∂–¥–æ–µ —Ñ–æ—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ

---

## DEBUG —Ä–µ–∂–∏–º

```
[Scraper] –ò–∑–≤–ª–µ—á–µ–Ω–æ 13 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ sku_props
```

–ò–ª–∏ –≤ —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è:
```
[Scraper] sku_props –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º main_imgs
[Scraper] –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ sku_props –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º main_imgs
```

---

## Fallback –º–µ—Ö–∞–Ω–∏–∑–º

### –°–ª—É—á–∞–π 1: sku_props –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
```python
if not sku_props:
    return product_data.get('main_imgs', [])
```

### –°–ª—É—á–∞–π 2: sku_props –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç imageUrl
```python
if not unique_images:
    return product_data.get('main_imgs', [])
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ—Ç –í–°–ï–ì–î–ê –ø–æ–ª—É—á–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è.

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | main_imgs | sku_props (NEW) |
|----------|-----------|-----------------|
| –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| –ü–æ–∫–∞–∑ –≤—Å–µ—Ö —Ü–≤–µ—Ç–æ–≤ | ‚ùå –ú–æ–∂–µ—Ç –Ω–µ –ø–æ–∫–∞–∑–∞—Ç—å | ‚úÖ –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã |
| –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å | ‚ö†Ô∏è –ú–æ–≥—É—Ç –±—ã—Ç—å –¥—É–±–ª–∏ | ‚úÖ –¢–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ | ~5 | ~13+ |
| Fallback | - | ‚úÖ –ï—Å—Ç—å |

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

–í `handlers.py` –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç:
```python
post_text, image_urls = await scraper.scrape_product_data(item_id)

# image_urls —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ –∏–∑ sku_props!
```

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ —Ñ–æ—Ç–æ –∫–∞–∫ –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø—É:
```python
media = []
for idx, img_url in enumerate(image_urls):
    if idx == 0:
        media.append(InputMediaPhoto(media=img_url, caption=post_text))
    else:
        media.append(InputMediaPhoto(media=img_url))

await message.answer_media_group(media)
```

---

## –ò—Ç–æ–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

```
1. –ü–æ–ª—É—á–∞–µ–º product_data –æ—Ç TMAPI
           ‚Üì
2. _get_unique_images_from_sku_props()
           ‚Üì
3. –ü—Ä–æ–≤–µ—Ä—è–µ–º sku_props ‚Üí –µ—Å—Ç—å?
   ‚îÇ
   ‚îú‚îÄ –î–∞ ‚Üí –ò–∑–≤–ª–µ–∫–∞–µ–º imageUrl –∏–∑ values
   ‚îÇ        ‚Üì
   ‚îÇ   –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (—á–µ—Ä–µ–∑ set)
   ‚îÇ        ‚Üì
   ‚îÇ   –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö URL
   ‚îÇ
   ‚îî‚îÄ –ù–µ—Ç ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ–º main_imgs (fallback)
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –ë–æ–ª—å—à–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ç–æ–≤–∞—Ä–∞  
‚úÖ –§–æ—Ç–æ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º  
‚úÖ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –í–°–ï –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ü–≤–µ—Ç–∞/–º–æ–¥–µ–ª–∏  
‚úÖ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤  
‚úÖ –ù–∞–¥–µ–∂–Ω—ã–π fallback –Ω–∞ main_imgs

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ

