# üì¶ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è YandexGPT

## –ü—Ä–æ–±–ª–µ–º–∞ (–ë–´–õ–û)

### ‚ùå –ü–µ—Ä–µ–¥–∞–≤–∞–ª–∏ –í–ï–°–¨ product_data:
```json
{
  "item_id": 751881208330,
  "title": "...",
  "main_imgs": [...],
  "price_info": {...},
  "product_props": [...],
  "delivery_info": {...},
  "shop_info": {...},
  "sku_props": [...],
  "skus": [
    {"skuid": "...", "sale_price": "...", ...},
    {"skuid": "...", "sale_price": "...", ...},
    ... // 312 —ç–ª–µ–º–µ–Ω—Ç–æ–≤!!!
  ]
}
```

**–†–∞–∑–º–µ—Ä:** 50,000+ —Å–∏–º–≤–æ–ª–æ–≤  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `400 Bad Request` –æ—Ç YandexGPT API

---

## –†–µ—à–µ–Ω–∏–µ (–°–¢–ê–õ–û)

### ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º –¢–û–õ–¨–ö–û –Ω—É–∂–Ω–æ–µ:
```json
{
  "title": "ÈÄÇÁî®iphone17proÊâãÊú∫Â£≥17promaxÈÖíÁ∫¢Ëâ≤...",
  "product_props": [
    {"ÂìÅÁâå": "È≥åËôé"},
    {"ÂûãÂè∑": "Á£®Á†ÇÁ°¨Â£≥ËÇ§ÊÑüÊ∂≤ÊÄÅÁ°ÖËÉ∂ÊâãÊú∫Â£≥..."},
    {"ÊµÅË°åÂÖÉÁ¥†": "Á£®Á†Ç"},
    {"ÈÄÇÁî®ÊâãÊú∫ÂûãÂè∑": "iPhone 11 Pro Max iPhone 15..."},
    {"‰øùÊä§Â•óË¥®Âú∞": "‰∫öÂÖãÂäõ"},
    {"È¢úËâ≤ÂàÜÁ±ª": "„ÄêÈÖíÁ∫¢Ëâ≤„ÄëËÇ§ÊÑüÁ£®Á†ÇÁ°¨Â£≥‚òÖËá™Â∏¶ÈïúÂ§¥ËÜú „ÄêÊöóÂ§úÁ¥´„Äë..."}
  ],
  "available_colors": [
    "„ÄêÈÖíÁ∫¢Ëâ≤„ÄëËÇ§ÊÑüÁ£®Á†ÇÁ°¨Â£≥‚òÖËá™Â∏¶ÈïúÂ§¥ËÜú",
    "„ÄêÊöóÂ§úÁ¥´„ÄëËÇ§ÊÑüÁ£®Á†ÇÁ°¨Â£≥‚òÖËá™Â∏¶ÈïúÂ§¥ËÜú",
    "„ÄêÈíõÁÅ∞Ëâ≤„ÄëËÇ§ÊÑüÁ£®Á†ÇÁ°¨Â£≥‚òÖËá™Â∏¶ÈïúÂ§¥ËÜú",
    ...
  ],
  "available_sizes": [
    "iPhone 17",
    "iPhone Air",
    "iPhone 17 Pro",
    "iPhone 17 Pro Max",
    ...
  ]
}
```

**–†–∞–∑–º–µ—Ä:** 500-2000 —Å–∏–º–≤–æ–ª–æ–≤  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ YandexGPT

---

## –ß—Ç–æ –∏—Å–∫–ª—é—á–∏–ª–∏

‚ùå **skus** - —Å–æ—Ç–Ω–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∫–∞–∂–¥–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Ü–≤–µ—Ç+—Ä–∞–∑–º–µ—Ä)  
‚ùå **delivery_info** - –Ω–µ –Ω—É–∂–Ω–æ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è  
‚ùå **shop_info** - –Ω–µ –Ω—É–∂–Ω–æ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è  
‚ùå **main_imgs** - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç–µ  
‚ùå **price_info** - —Ü–µ–Ω—É –±–µ—Ä–µ–º –∏–∑ skus –æ—Ç–¥–µ–ª—å–Ω–æ

---

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç TMAPI
```python
product_data = await self.tmapi_client.get_product_info(item_id)
# –ü–æ–ª–Ω—ã–π JSON —Å —Å–æ—Ç–Ω—è–º–∏ SKU
```

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```python
compact_data = self._prepare_compact_data_for_llm(product_data)
# –¢–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è
```

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```python
llm_content = await self.yandex_gpt_client.generate_post_content(compact_data)
# YandexGPT –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π JSON
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã
```python
price = self._get_max_price_from_skus(product_data)
# –ë–µ—Ä–µ–º –∏–∑ –ü–û–õ–ù–´–• –¥–∞–Ω–Ω—ã—Ö, –Ω–µ –∏–∑ –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö
```

---

## –ú–µ—Ç–æ–¥ `_prepare_compact_data_for_llm()`

```python
def _prepare_compact_data_for_llm(self, product_data: dict) -> dict:
    """
    –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ LLM.
    –£–±–∏—Ä–∞–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π –º–∞—Å—Å–∏–≤ skus –∏ –¥—Ä—É–≥–∏–µ –ª–∏—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ.
    """
    compact = {
        'title': product_data.get('title', ''),
        'product_props': product_data.get('product_props', [])
    }
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä—ã –∏–∑ sku_props
    sku_props = product_data.get('sku_props', [])
    if sku_props:
        for prop in sku_props:
            prop_name = prop.get('prop_name', '')
            
            # –¶–≤–µ—Ç–∞ (–º–∞–∫—Å–∏–º—É–º 20)
            if '—Ü–≤–µ—Ç' in prop_name.lower() or 'color' in prop_name.lower():
                colors = [v.get('name', '') for v in prop.get('values', [])]
                if colors:
                    compact['available_colors'] = colors[:20]
            
            # –†–∞–∑–º–µ—Ä—ã (–º–∞–∫—Å–∏–º—É–º 30)
            if '—Ä–∞–∑–º–µ—Ä' in prop_name.lower() or 'size' in prop_name.lower():
                sizes = [v.get('name', '') for v in prop.get('values', [])]
                if sizes:
                    compact['available_sizes'] = sizes[:30]
    
    return compact
```

---

## –ü—Ä–∏–º–µ—Ä—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ë–´–õ–û):
```
–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ YandexGPT: 52,487 —Å–∏–º–≤–æ–ª–æ–≤
–†–µ–∑—É–ª—å—Ç–∞—Ç: 400 Bad Request
```

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–°–¢–ê–õ–û):
```
–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ YandexGPT: 1,234 —Å–∏–º–≤–æ–ª–∞
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –£—Å–ø–µ—Ö
```

**–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞: ~40 —Ä–∞–∑!** üöÄ

---

## –í–∞–∂–Ω–æ

1. ‚úÖ **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è LLM
2. ‚úÖ **–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (`product_data`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:
   - –ü–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã –∏–∑ `skus`
   - –ü–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ `main_imgs`
   - –î—Ä—É–≥–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ Python

3. ‚úÖ **LLM –ø–æ–ª—É—á–∞–µ—Ç**:
   - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
   - –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (props)
   - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤
   - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤

4. ‚úÖ **LLM –ù–ï –ø–æ–ª—É—á–∞–µ—Ç**:
   - –°–æ—Ç–Ω–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ SKU
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–æ—Å—Ç–∞–≤–∫–µ
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–≥–∞–∑–∏–Ω–µ
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

---

## Debug —Ä–µ–∂–∏–º

```
[Scraper] –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è LLM –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã. –†–∞–∑–º–µ—Ä: ~1234 —Å–∏–º–≤–æ–ª–æ–≤
[Scraper] –ò—Å–∫–ª—é—á–µ–Ω–æ 312 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ skus
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –û—à–∏–±–∫–∞ `400 Bad Request` —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞  
‚úÖ –ó–∞–ø—Ä–æ—Å—ã –∫ YandexGPT –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ  
‚úÖ –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å  
‚úÖ –†–∞–∑–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞ —É–º–µ–Ω—å—à–∏–ª—Å—è –≤ ~40 —Ä–∞–∑

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω–æ

