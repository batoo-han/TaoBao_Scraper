# –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –û–±–∑–æ—Ä

–í –≤–µ—Ä—Å–∏–∏ 2.1.0 –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LLM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏.  
–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ PostgreSQL (—Å–º. `docs/DB_SCHEMA_PLAN.md`).

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä            | –û–ø–∏—Å–∞–Ω–∏–µ                                                            |
|---------------------|---------------------------------------------------------------------|
| –ü–æ–¥–ø–∏—Å—å             | –°—Ç—Ä–æ–∫–∞, –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü –ø–æ—Å—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `@annabbox`)        |
| –í–∞–ª—é—Ç–∞              | `cny` –∏–ª–∏ `rub`. –î–ª—è `rub` —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å –∫—É—Ä—Å –≤—Ä—É—á–Ω—É—é           |
| –ö—É—Ä—Å —Ä—É–±–ª—è          | –ó–Ω–∞—á–µ–Ω–∏–µ 1 ¬• ‚Üí ‚ÇΩ. –í–≤–æ–¥–∏—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ `rub`, —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î          |

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é (`–ú–µ–Ω—é`) –∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫:

- `/start` ‚Äî –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é;
- `/request` ‚Äî –∑–∞–ø—Ä–æ—Å –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞;
- `/about` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ;
- `/faq` ‚Äî —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã;
- `/settings` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤;
- `/mysettings` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π;
- `/subscription` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö (–±—É–¥—É—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª).

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´üì¶ –ó–∞–ø—Ä–æ—Å–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞¬ª –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —á–∞—Ç–µ. –ö–Ω–æ–ø–∫–∞ `/start` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

## LLM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

- –£–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ (–∞–¥–º–∏–Ω–∫–∞, `AppSettingsService`).
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è `yandex`, `openai`, `proxiapi` (–≤—Å–µ —Ç—Ä–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã).
- –ê–¥–º–∏–Ω –≤—ã–±–∏—Ä–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å).
- –í `LLMProviderManager` –¥–æ–±–∞–≤–ª–µ–Ω–æ:
  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ (`llm_cache`)
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (`usage_stats`)
- –í—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `LLMProvider` –∏–∑ `src/api/llm/base.py`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î (—Å–º–æ—Ç—Ä–∏—Ç–µ `docs/DB_SCHEMA_PLAN.md`)

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

- `users`, `user_settings`, `admin_users`
- `app_settings` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ç–µ–∫—Å—Ç —Å–æ–≥–ª–∞—Å–∏—è
- `llm_cache`, `usage_stats`
- `pd_audit_log` ‚Äî –∂—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

### –ë—ã—Å—Ç—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü!

```bash
# 1. –í—ã–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
# –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ psql (–æ—Ç –∏–º–µ–Ω–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
psql -U postgres -d taobao_scraper -f scripts/fix_db_permissions.sql

# –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ PowerShell —Å–∫—Ä–∏–ø—Ç
powershell -ExecutionPolicy Bypass -File scripts/fix_db_permissions.ps1

# –í–∞—Ä–∏–∞–Ω—Ç C: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ pgAdmin
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ scripts/fix_db_permissions.sql (GRANT ... TO taobao)

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ë–î
python scripts/bootstrap_db.py
```

### –†—É—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–º. `.env.example`).

2. **–í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Alembic (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)**
   ```bash
   # –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
   alembic revision --autogenerate -m "Initial schema"
   
   # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
   alembic upgrade head
   ```

3. **–í–∞—Ä–∏–∞–Ω—Ç B: –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –Ω–∞–ø—Ä—è–º—É—é (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)**
   ```bash
   python -m src.db.init_db
   ```

4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   ```bash
   python scripts/init_app_settings.py
   ```

5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º –±–æ—Ç–∞.

## .env –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–µ–∂–Ω–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –¥–æ–±–∞–≤–ª–µ–Ω—ã:

- `POSTGRES_HOST`, `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`
- `DEFAULT_SIGNATURE`, `DEFAULT_CURRENCY`, `DEFAULT_LLM_VENDOR`
- `LLM_CACHE_TTL_MINUTES`
- `OPENAI_API_KEY`, `OPENAI_MODEL` (–¥–ª—è OpenAI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)
- `PROXIAPI_API_KEY`, `PROXIAPI_MODEL` (–¥–ª—è ProxiAPI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)

## –ü—Ä–∏–º–µ—Ä —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ü–î (–§–ó-152)

> **–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**  
> –Ø, ________________________________________, –ø–∞—Å–ø–æ—Ä—Ç: ________________________,  
> –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π(–∞—è) –ø–æ –∞–¥—Ä–µ—Å—É _____________________________________________,  
> –Ω–∞—Å—Ç–æ—è—â–∏–º —Å–≤–æ–±–æ–¥–Ω–æ, —Å–≤–æ–µ–π –≤–æ–ª–µ–π –∏ –≤ —Å–≤–æ—ë–º –∏–Ω—Ç–µ—Ä–µ—Å–µ –≤—ã—Ä–∞–∂–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–º—É –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—é __________________________ (–ò–ù–ù _____________, –û–ì–†–ù–ò–ü _____________, –∞–¥—Ä–µ—Å: _________________________________) –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.  
>
> **–°–æ—Å—Ç–∞–≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:** —Ñ–∞–º–∏–ª–∏—è, –∏–º—è, –æ—Ç—á–µ—Å—Ç–≤–æ; Telegram ID –∏ username; –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ; —Å–≤–µ–¥–µ–Ω–∏—è –æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ –∏ –∏—Å—Ç–æ—Ä–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π.  
>
> **–¶–µ–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏:** —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Telegram-–±–æ—Ç–µ, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –ø–æ –∑–∞–∫–∞–∑–∞–º, –≤–µ–¥–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É —Å–µ—Ä–≤–∏—Å–∞ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É-–æ—Ñ–µ—Ä—Ç–µ.  
>
> **–î–µ–π—Å—Ç–≤–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏:** —Å–±–æ—Ä, –∑–∞–ø–∏—Å—å, —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è, –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —É—Ç–æ—á–Ω–µ–Ω–∏–µ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ), –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±–µ–∑–ª–∏—á–∏–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ; –ø–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∑–∞–∫–æ–Ω–Ω—ã—Ö –æ—Å–Ω–æ–≤–∞–Ω–∏–π.  
>
> **–°—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏:** –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ –¥–æ –æ—Ç–∑—ã–≤–∞ —Å–æ–≥–ª–∞—Å–∏—è.  
>
> –°–æ–≥–ª–∞—Å–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–æ–∑–≤–∞–Ω–æ –ø—É—Ç—ë–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∏—Å—å–º–µ–Ω–Ω–æ–≥–æ –∑–∞—è–≤–ª–µ–Ω–∏—è –Ω–∞ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã _____________________.  
> –û–∑–Ω–∞–∫–æ–º–ª–µ–Ω(–∞) —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: _______________________________.  
>
> ¬´___¬ª __________ 20___ –≥.      ______________________ (–ø–æ–¥–ø–∏—Å—å)

## –°–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

- `scripts/bootstrap_db.py` ‚Äî –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `scripts/init_app_settings.py` ‚Äî —Ç–æ–ª—å–∫–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AppSettings
- `src/db/init_db.py` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –Ω–∞–ø—Ä—è–º—É—é (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

## TODO / –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–µ–±-–∞–¥–º–∏–Ω–∫—É (UI + API)
- –í–Ω–µ–¥—Ä–∏—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏


